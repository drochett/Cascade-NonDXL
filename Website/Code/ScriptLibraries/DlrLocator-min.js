var geocoder;var map;var CONST_BLUE="rgb(92, 111, 255)";var CONST_YELLOW="rgb(255, 247, 0)";var CONST_GREEN="rgb(32, 204, 16)";var tableid="1Bth5LVMDpXkVUBMDJF3dFILcWdyoWZYD8Gta2io";var territoryTableID="1x7Hi8EM2IW_SV7sf1H70JRDE1CBQq2zxZjScO80";var map_zoom_LOD=7;function initialize(){geocoder=new google.maps.Geocoder;google.maps.visualRefresh=true;map=new google.maps.Map(document.getElementById("googft-mapCanvas"),{center:new google.maps.LatLng(41.85770587817565,252.51400671797455),zoom:3,panControl:false,streetViewControl:true,scaleControl:true,overviewMapControl:true,mapTypeId:google.maps.MapTypeId.ROADMAP});map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(document.getElementById("googft-legend"));layerDealer=new google.maps.FusionTablesLayer({map:map,heatmap:{enabled:false},query:{select:"col2",from:tableid,where:"col3 \x3d \x27D\x27"},options:{styleId:3,templateId:3}});google.maps.event.addListener(map,"idle",function(){var c=document.getElementById("ft-data");c.innerHTML="";if(map.getZoom()>map_zoom_LOD){sw=map.getBounds().getSouthWest();ne=map.getBounds().getNorthEast();var d="SELECT ABALPH,ADDRSTRING,TRUCKLINE1, ABAT1 FROM "+tableid+" WHERE ST_INTERSECTS(col2, RECTANGLE(LATLNG("+sw.lat()+","+sw.lng()+"), LATLNG("+ne.lat()+","+ne.lng()+"))) AND col3 = 'D'";var b=encodeURIComponent(d);var a=["https://www.googleapis.com/fusiontables/v1/query"];a.push("?sql="+b);a.push("&key=AIzaSyCRLpoReSWU0ctvYiTL8roZgftETEmSEC8");a.push("&callback=?");$.ajax({url:a.join(""),dataType:"jsonp",error:function(e,f,g){alert(e.response.message)},success:function(g){var o=g.rows;for(var h in o){var p=o[h][0];var n=o[h][1];var j=o[h][2];var k=o[h][3];var e=encodeURIComponent(n);var m='<div class="'+k+'" onClick="dlrClick(\''+e+"')\">"+p+"</b><br /><div>"+n+"</div>Truck Line: "+j+"</div>";var f=document.createElement("div");var l=document.createElement("div");l.innerHTML=m;l.className="Dealer";f.appendChild(l);c.appendChild(f)}}})}else{c.innerHTML="Zoom in to show dealers in view"}})}function codeAddress(){var a=document.getElementById("address").value;geocoder.geocode({address:a},function(c,b){if(b==google.maps.GeocoderStatus.OK){map.setCenter(c[0].geometry.location);map.fitBounds(c[0].geometry.viewport)}else{alert("Geocode was not successful for the following reason: "+b)}})}function dlrClick(b){var a=document.getElementById("address");a.value=decodeURIComponent(b);codeAddress()}google.maps.event.addDomListener(window,"load",initialize);var timeout;function handleKeyPress(c,b){var a=c.keyCode||c.which;if(a==13){codeAddress()}}function toggleLayer(a){if(a.getMap()){a.setMap(null)}else{layerDealer.setMap(null);layerTerritory.setMap(null);layerTerritory.setMap(map);setTimeout(function(){layerDealer.setMap(map)},1000)}}function toggleColor(b,a){if(b.style.backgroundColor==a){b.style.backgroundColor="gray"}else{b.style.backgroundColor=a}}function ToggleControl(b,d){b.style.padding="5px";var c=document.createElement("div");c.style.backgroundColor="white";c.style.borderColor="grey";c.style.borderStyle="solid";c.style.borderWidth="1px";c.style.cursor="pointer";c.style.textAlign="center";c.style.padding="2px";c.title="Toggles to display types of dealers";b.appendChild(c);var a=document.createElement("div");a.style.backgroundColor=CONST_YELLOW;a.style.marginTop="2px";a.style.borderColor="grey";a.style.borderStyle="solid";a.style.borderWidth="1px";a.style.borderRadius="3px";a.style.cursor="pointer";a.style.textAlign="center";a.style.padding="2px";a.title="Toggles Territories Layer on/off";c.appendChild(a);var e=document.createElement("div");e.style.fontFamily="Arial,sans-serif";e.style.fontSize="12px";e.style.color="black";e.style.paddingLeft="4px";e.style.paddingRight="4px";e.innerHTML="<strong>Territories Layer</strong>";a.appendChild(e);google.maps.event.addDomListener(a,"click",function(){toggleLayer(layerTerritory);toggleColor(a,CONST_YELLOW)})};